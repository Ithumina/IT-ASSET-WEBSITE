<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Souq AL Baladi IT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        dark: {
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-dark-950 text-white">

    <!-- Auth Check -->
    <script>
        if (localStorage.getItem('isAdmin') !== 'true') {
            window.location.href = 'login.html';
        }

        function logout() {
            localStorage.removeItem('isAdmin');
            window.location.href = 'index.html';
        }
    </script>

    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar -->
        <div class="w-64 bg-dark-900 border-r border-gray-800 hidden md:flex flex-col">
            <div class="p-6">
                <a href="index.html" class="text-xl font-bold tracking-tighter">
                    <span class="text-brand-500">Baladi</span><span class="text-white"> IT Department</span>
                </a>
                <p class="text-xs text-gray-500 mt-2">Admin Dashboard</p>
            </div>
            <nav class="flex-1 px-4 space-y-2">
                <button onclick="showSection('requests')" id="nav-requests"
                    class="w-full text-left px-4 py-3 bg-brand-600/10 text-brand-500 rounded-lg font-medium transition-colors"><i
                        class="fas fa-clipboard-list w-6"></i> Asset Requests</button>
                <button onclick="showSection('staff')" id="nav-staff"
                    class="w-full text-left px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors"><i
                        class="fas fa-users-cog w-6"></i> Manage Staff</button>
                <button onclick="showSection('settings')" id="nav-settings"
                    class="w-full text-left px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors"><i
                        class="fas fa-cog w-6"></i> Settings</button>

                <div class="border-t border-gray-800 my-2"></div>
                <a href="index.html"
                    class="block px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors"><i
                        class="fas fa-home w-6"></i> View Website</a>
            </nav>
            <div class="p-4 border-t border-gray-800">
                <button onclick="logout()"
                    class="flex items-center text-gray-400 hover:text-red-500 transition-colors w-full px-4 py-2">
                    <i class="fas fa-sign-out-alt w-6"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <div class="p-8">

                <!-- SECTION: Asset Requests -->
                <div id="section-requests" class="section-content">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold">Asset Requests</h1>
                        <button onclick="clearRequests()"
                            class="text-red-500 hover:text-red-400 font-medium text-sm border border-red-500/20 px-4 py-2 rounded-lg hover:bg-red-500/10 transition-colors">
                            Clear All History
                        </button>
                    </div>
                    <div class="bg-dark-900 rounded-2xl border border-gray-800 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-dark-800 text-gray-400 text-sm uppercase">
                                    <tr>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4">Date</th>
                                        <th class="px-6 py-4">Employee</th>
                                        <th class="px-6 py-4">Asset Type</th>
                                        <th class="px-6 py-4">Priority</th>
                                        <th class="px-6 py-4">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="request-table-body" class="divide-y divide-gray-800 text-sm">
                                    <!-- Populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- SECTION: Manage Staff -->
                <div id="section-staff" class="section-content hidden">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold">Manage Staff</h1>
                        <button onclick="openStaffModal()"
                            class="bg-brand-600 hover:bg-brand-500 text-white px-6 py-2 rounded-lg font-bold shadow-lg shadow-brand-500/30 transition-all flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add Staff Member
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="staff-grid">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <!-- SECTION: Settings -->
                <div id="section-settings" class="section-content hidden">
                    <h1 class="text-3xl font-bold mb-8">System Settings</h1>

                    <div class="bg-dark-900 border border-gray-800 rounded-2xl p-8 max-w-2xl">
                        <h2 class="text-xl font-bold mb-6 border-b border-gray-800 pb-4">Notification Settings</h2>
                        <form onsubmit="saveSettings(event)" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Admin Notification
                                    Email</label>
                                <p class="text-xs text-gray-500 mb-2">Asset requests will be sent to this email address.
                                </p>
                                <input type="email" id="admin-email" required
                                    class="w-full bg-dark-800 border border-gray-700 rounded-lg py-3 px-4 text-white focus:outline-none focus:border-brand-500 transition-colors">
                            </div>
                            <button type="submit"
                                class="bg-brand-600 hover:bg-brand-500 text-white px-8 py-3 rounded-lg font-bold transition-all">
                                Save Changes
                            </button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Request Details Modal -->
    <div id="details-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-dark-900 border border-gray-700 rounded-2xl w-full max-w-lg p-6 relative">
            <button onclick="document.getElementById('details-modal').classList.add('hidden')"
                class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6">Request Details</h2>
            <div id="modal-content" class="space-y-4 text-gray-300">
                <!-- Content here -->
            </div>
            <div class="mt-6 flex space-x-3">
                <button onclick="updateStatus('Approved')"
                    class="flex-1 bg-green-600 hover:bg-green-500 text-white py-2 rounded-lg font-bold">Approve</button>
                <button onclick="updateStatus('Rejected')"
                    class="flex-1 bg-red-600 hover:bg-red-500 text-white py-2 rounded-lg font-bold">Reject</button>
            </div>
        </div>
    </div>

    <!-- Staff Edit Modal -->
    <div id="staff-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-dark-900 border border-gray-700 rounded-2xl w-full max-w-lg p-6 relative">
            <button onclick="document.getElementById('staff-modal').classList.add('hidden')"
                class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6" id="staff-modal-title">Add Staff Member</h2>
            <form onsubmit="saveStaff(event)" class="space-y-4">
                <input type="hidden" id="staff-id">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Name</label>
                    <input type="text" id="staff-name" required
                        class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Role / Title</label>
                    <input type="text" id="staff-title" placeholder="e.g. Network Admin" required
                        class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Category (Sets Icon)</label>
                    <select id="staff-category"
                        class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                        <option value="account">Account & Email (Key)</option>
                        <option value="network">Network (Wifi)</option>
                        <option value="hardware">Hardware (Desktop)</option>
                        <option value="software">Software (Windows)</option>
                        <option value="server">Server (Server)</option>
                        <option value="other">Other (Headset)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
                    <input type="text" id="staff-desc" placeholder="e.g. VPN issues, Wifi access" required
                        class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Phone Number</label>
                        <input type="text" id="staff-phone" placeholder="+974..." required
                            class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">WhatsApp</label>
                        <input type="text" id="staff-whatsapp" placeholder="974399..."
                            class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Email Address</label>
                    <input type="email" id="staff-email" placeholder="staff@souqalbaladi.com"
                        class="w-full bg-dark-800 border border-gray-700 rounded-lg p-3 text-white focus:border-brand-500 focus:outline-none">
                </div>
                <button type="submit"
                    class="w-full bg-brand-600 hover:bg-brand-500 text-white py-3 rounded-lg font-bold mt-4 shadow-lg">
                    Save Staff Member
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- NAVIGATION ---
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            // Remove active class from navs
            document.getElementById('nav-requests').classList.remove('bg-brand-600/10', 'text-brand-500');
            document.getElementById('nav-requests').classList.add('text-gray-400');
            document.getElementById('nav-staff').classList.remove('bg-brand-600/10', 'text-brand-500');
            document.getElementById('nav-staff').classList.add('text-gray-400');
            document.getElementById('nav-settings').classList.remove('bg-brand-600/10', 'text-brand-500');
            document.getElementById('nav-settings').classList.add('text-gray-400');

            // Show target section
            document.getElementById('section-' + sectionId).classList.remove('hidden');

            // Add active class
            const navBtn = document.getElementById('nav-' + sectionId);
            navBtn.classList.remove('text-gray-400');
            navBtn.classList.add('bg-brand-600/10', 'text-brand-500');

            if (sectionId === 'settings') loadSettings();
            if (sectionId === 'staff') renderStaff();
        }


        // --- REQUESTS LOGIC ---
        let currentRequestId = null;

        function getRequests() {
            return JSON.parse(localStorage.getItem('assetRequests')) || [];
        }

        function renderTable() {
            const requests = getRequests().sort((a, b) => new Date(b.date) - new Date(a.date));
            const tbody = document.getElementById('request-table-body');

            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">No requests found.</td></tr>';
                return;
            }

            tbody.innerHTML = requests.map(r => `
                <tr class="hover:bg-white/5 transition-colors cursor-pointer" onclick="viewDetails(${r.id})">
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 rounded text-xs font-bold ${getStatusColor(r.status)}">
                            ${r.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-400">${r.date}</td>
                    <td class="px-6 py-4 font-medium">
                        ${r.empName}<br>
                        <span class="text-xs text-gray-500">${r.department}</span>
                    </td>
                    <td class="px-6 py-4 text-brand-400">
                        ${r.assetType}<br>
                        <span class="text-xs text-gray-500">Qty: ${r.quantity || 1}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="${r.priority === 'High' ? 'text-red-500 font-bold' : 'text-gray-400'}">${r.priority}</span>
                    </td>
                    <td class="px-6 py-4">
                        <button class="text-brand-500 hover:text-white">View</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            if (status === 'Approved') return 'bg-green-500/20 text-green-400';
            if (status === 'Rejected') return 'bg-red-500/20 text-red-400';
            return 'bg-yellow-500/20 text-yellow-400';
        }

        function viewDetails(id) {
            const requests = getRequests();
            const r = requests.find(req => req.id === id);
            if (!r) return;

            currentRequestId = id;
            const content = document.getElementById('modal-content');
            content.innerHTML = `
                <p><strong class="text-white">Employee:</strong> ${r.empName} (${r.empID})</p>
                <p><strong class="text-white">Department:</strong> ${r.department}</p>
                <p><strong class="text-white">Asset Type:</strong> ${r.assetType}</p>
                <p><strong class="text-white">Quantity:</strong> ${r.quantity || 1}</p>
                <p><strong class="text-white">Priority:</strong> <span class="${r.priority === 'High' ? 'text-red-400' : ''}">${r.priority}</span></p>
                <div class="bg-dark-800 p-3 rounded-lg border border-gray-700 mt-2">
                    <p class="text-sm text-gray-500 uppercase mb-1">Reason</p>
                    <p>${r.reason}</p>
                </div>
            `;
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function updateStatus(status) {
            const requests = getRequests();
            const index = requests.findIndex(r => r.id === currentRequestId);
            if (index !== -1) {
                requests[index].status = status;
                localStorage.setItem('assetRequests', JSON.stringify(requests));
                document.getElementById('details-modal').classList.add('hidden');
                renderTable();
            }
        }

        function clearRequests() {
            if (confirm('Delete all request history? This cannot be undone.')) {
                localStorage.removeItem('assetRequests');
                renderTable();
            }
        }

        // --- STAFF LOGIC ---
        const defaultStaff = [
            { id: 1, name: 'Mr. Ithumina', role: 'Account Access', category: 'account', desc: 'Password resets, Email issues', phone: '+974 39927191', email: 'ithumina@example.com', whatsapp: '97439927191' },
            { id: 2, name: 'Mr. Staff', role: 'Network Support', category: 'network', desc: 'Connectivity, Wifi, VPN', phone: '+974 00000000', email: 'network@example.com', whatsapp: '' }
        ];

        function getStaff() {
            let staff = JSON.parse(localStorage.getItem('itStaff'));
            if (!staff || staff.length === 0) {
                staff = defaultStaff;
                localStorage.setItem('itStaff', JSON.stringify(staff));
            }
            return staff;
        }

        function renderStaff() {
            const staff = getStaff();
            const grid = document.getElementById('staff-grid');
            grid.innerHTML = staff.map(s => `
                <div class="glass p-6 rounded-2xl relative group">
                    <div class="absolute top-4 right-4 flex space-x-2">
                        <button onclick="openStaffModal(${s.id})" class="text-gray-500 hover:text-blue-500 transition-colors bg-dark-800 p-2 rounded-lg"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteStaff(${s.id})" class="text-gray-500 hover:text-red-500 transition-colors bg-dark-800 p-2 rounded-lg"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="w-12 h-12 ${getIconColor(s.category)} rounded-xl flex items-center justify-center mb-4">
                        <i class="${getIcon(s.category)} text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-bold mb-1">${s.role}</h3>
                    <p class="text-brand-500 font-medium mb-2">${s.name}</p>
                    <p class="text-xs text-gray-400 mb-4 h-8 overflow-hidden">${s.desc}</p>
                    <div class="space-y-2">
                         <div class="bg-white/5 px-3 py-2 rounded-lg flex items-center text-sm">
                            <i class="fas fa-phone w-6 text-gray-400"></i> ${s.phone}
                        </div>
                        <div class="bg-white/5 px-3 py-2 rounded-lg flex items-center text-sm">
                            <i class="fab fa-whatsapp w-6 text-green-400"></i> ${s.whatsapp || '-'}
                        </div>
                         <div class="bg-white/5 px-3 py-2 rounded-lg flex items-center text-sm overflow-hidden">
                            <i class="fas fa-envelope w-6 text-blue-400"></i> <span class="truncate">${s.email || '-'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getIcon(category) {
            const icons = {
                account: 'fas fa-key',
                network: 'fas fa-wifi',
                hardware: 'fas fa-desktop',
                software: 'fab fa-windows',
                server: 'fas fa-server',
                other: 'fas fa-headset'
            };
            return icons[category] || 'fas fa-headset';
        }

        function getIconColor(category) {
            const colors = {
                account: 'bg-blue-500/20 text-blue-400',
                network: 'bg-green-500/20 text-green-400',
                hardware: 'bg-yellow-500/20 text-yellow-400',
                software: 'bg-purple-500/20 text-purple-400',
                server: 'bg-red-500/20 text-red-400',
                other: 'bg-pink-500/20 text-pink-400'
            };
            return colors[category] || 'bg-gray-500/20 text-gray-400';
        }

        function openStaffModal(id = null) {
            if (id) {
                // Edit Mode
                const staff = getStaff().find(s => s.id === id);
                if (staff) {
                    document.getElementById('staff-id').value = staff.id;
                    document.getElementById('staff-name').value = staff.name;
                    document.getElementById('staff-title').value = staff.role;
                    document.getElementById('staff-category').value = staff.category;
                    document.getElementById('staff-desc').value = staff.desc;
                    document.getElementById('staff-phone').value = staff.phone;
                    document.getElementById('staff-whatsapp').value = staff.whatsapp || '';
                    document.getElementById('staff-email').value = staff.email || '';
                    document.getElementById('staff-modal-title').textContent = 'Edit Staff Member';
                }
            } else {
                // Add Mode
                document.getElementById('staff-id').value = '';
                document.getElementById('staff-modal').querySelector('form').reset();
                document.getElementById('staff-modal-title').textContent = 'Add Staff Member';
            }
            document.getElementById('staff-modal').classList.remove('hidden');
        }

        function saveStaff(e) {
            e.preventDefault();
            const idInput = document.getElementById('staff-id').value;
            const name = document.getElementById('staff-name').value;
            const title = document.getElementById('staff-title').value; // Mapped to 'role'
            const cat = document.getElementById('staff-category').value;
            const desc = document.getElementById('staff-desc').value;
            const phone = document.getElementById('staff-phone').value;
            const whatsapp = document.getElementById('staff-whatsapp').value;
            const email = document.getElementById('staff-email').value;

            let staff = getStaff();

            if (idInput) {
                // Edit Existing
                const index = staff.findIndex(s => s.id === parseInt(idInput));
                if (index !== -1) {
                    staff[index] = { id: parseInt(idInput), name, role: title, category: cat, desc, phone, whatsapp, email };
                }
            } else {
                // Add New
                const newId = staff.length > 0 ? Math.max(...staff.map(s => s.id)) + 1 : 1;
                staff.push({ id: newId, name, role: title, category: cat, desc, phone, whatsapp, email });
            }

            localStorage.setItem('itStaff', JSON.stringify(staff));
            document.getElementById('staff-modal').classList.add('hidden');
            renderStaff();
        }

        function deleteStaff(id) {
            if (!confirm('Remove this staff member?')) return;
            let staff = getStaff();
            staff = staff.filter(s => s.id !== id);
            localStorage.setItem('itStaff', JSON.stringify(staff));
            renderStaff();
        }


        // --- SETTINGS LOGIC ---
        function loadSettings() {
            const email = localStorage.getItem('adminEmail') || 'ithuminaabeywickrama0000@gmail.com';
            document.getElementById('admin-email').value = email;
        }

        function saveSettings(e) {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            localStorage.setItem('adminEmail', email);
            alert('Settings Saved! Notification email updated.');
        }

        // Init
        renderTable();
    </script>
</body>

</html>